<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Master Queue System</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
        .animate-bounce-slow { animation: bounce 2s infinite; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(0); } }
        
        /* ซ่อน Scrollbar แต่ยังเลื่อนได้ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ==========================================
        // 1. ตั้งค่า FIREBASE Config (ค่าของคุณ)
        // ==========================================
        const YOUR_FIREBASE_CONFIG = {
            apiKey: "AIzaSyBsN1ACDYvJzoVc6mhtu9n-HNi1KDNFV24",
            authDomain: "project-6337867036145290950.firebaseapp.com",
            projectId: "project-6337867036145290950",
            storageBucket: "project-6337867036145290950.firebasestorage.app",
            messagingSenderId: "298203222498",
            appId: "1:298203222498:web:b3ef416d58b79c748ba9bb",
            measurementId: "G-1LJY6YJQBZ"
        };
        // ==========================================

        const initFirebase = () => {
            let config;
            if (YOUR_FIREBASE_CONFIG.apiKey === "วาง_API_KEY_ที่นี่" || YOUR_FIREBASE_CONFIG.apiKey === "") {
                 if (typeof __firebase_config !== 'undefined') {
                    config = JSON.parse(__firebase_config);
                 } else {
                    throw new Error("PLEASE_SETUP_FIREBASE");
                 }
            } else {
                config = YOUR_FIREBASE_CONFIG;
            }

            if (!firebase.apps.length) {
                try {
                    firebase.initializeApp(config);
                } catch (e) {
                    console.error("Firebase init failed", e);
                    throw e;
                }
            }
            return {
                auth: firebase.auth(),
                db: firebase.firestore()
            };
        };

        // --- ไอคอน (Lucide React) ---
        const Icon = ({ d, size=24, className="" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d}/></svg>
        );
        const Icons = {
            User: (p) => <Icon d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8" {...p} />,
            Monitor: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||24} height={p.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={p.className}><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>,
            Bell: (p) => <Icon d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9 M10.3 21a1.94 1.94 0 0 0 3.4 0" {...p} />,
            Check: (p) => <Icon d="M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4 12 14.01l-3-3" {...p} />,
            Clock: (p) => <Icon d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20 M12 6v6l4 2" {...p} />,
            Users: (p) => <Icon d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2 M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8 M22 21v-2a4 4 0 0 0-3-3.87 M16 3.13a4 4 0 0 1 0 7.75" {...p} />,
            Cross: (p) => <Icon d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20 M15 9l-6 6 M9 9l6 6" {...p} />,
            Volume: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||24} height={p.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={p.className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Link: (p) => <Icon d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6 M15 3h6v6 M10 14L21 3" {...p} />,
            Alert: (p) => <Icon d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01" {...p} />,
            Loader: (p) => <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width={24} height={24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>,
            Play: (p) => <Icon d="M5 3l14 9-14 9V3z" {...p} />
        };

        // --- Helper: Text-to-Speech ---
        const announceQueue = (queueNumber, customerName) => {
            if ('speechSynthesis' in window) {
                // ยกเลิกเสียงที่พูดค้างอยู่ (ถ้ามี)
                window.speechSynthesis.cancel();

                // ข้อความที่จะพูด
                const text = `ขอเชิญหมายเลข ${queueNumber}, คุณ${customerName}, ที่ช่องบริการค่ะ`;
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'th-TH'; // ภาษาไทย
                utterance.rate = 0.9; // ความเร็วปกติ
                utterance.pitch = 1; 
                utterance.volume = 1;

                window.speechSynthesis.speak(utterance);
            }
        };

        // --- Setup Error Component ---
        const SetupError = ({ errorMsg }) => (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                <div className="bg-white max-w-lg w-full rounded-2xl shadow-xl p-8 text-center border-t-4 border-red-500">
                    <div className="flex justify-center mb-4 text-red-500"><Icons.Alert size={64}/></div>
                    <h1 className="text-2xl font-bold text-slate-800 mb-2">เกิดข้อผิดพลาดในการเชื่อมต่อ</h1>
                    <p className="text-slate-600 mb-6 font-mono text-sm bg-slate-100 p-2 rounded break-all">
                        {errorMsg || "ไม่สามารถเชื่อมต่อกับ Firebase ได้"}
                    </p>
                    <a href="https://console.firebase.google.com/" target="_blank" className="inline-block bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-colors">
                        ไปที่ Firebase Console
                    </a>
                </div>
            </div>
        );

        function App() {
            // State
            const [viewMode, setViewMode] = useState('admin');
            const [queues, setQueues] = useState([]);
            const [myQueueId, setMyQueueId] = useState(() => localStorage.getItem('my_queue_id'));
            const [customerName, setCustomerName] = useState('');
            const [loading, setLoading] = useState(true);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [services, setServices] = useState(null);
            const [user, setUser] = useState(null); 
            const [configError, setConfigError] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');
            const [audioEnabled, setAudioEnabled] = useState(false); // New: Track if user enabled audio
            
            // Refs สำหรับกันการพูดซ้ำ
            const lastAnnouncedMyQueueRef = useRef(null);
            const lastAnnouncedDisplayRef = useRef(null);
            
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-queue-app';

            // Init Effect
            useEffect(() => {
                try {
                    const { auth, db } = initFirebase();
                    setServices({ auth, db });
                    
                    const unsubAuth = auth.onAuthStateChanged(async (u) => {
                        if (u) {
                            setUser(u); 
                        } else {
                            try {
                                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                    try {
                                        await auth.signInWithCustomToken(__initial_auth_token);
                                    } catch (tokenErr) {
                                        console.warn("Fallback to anonymous auth");
                                        await auth.signInAnonymously();
                                    }
                                } else {
                                    await auth.signInAnonymously();
                                }
                            } catch (authErr) {
                                console.error("Auth Error:", authErr);
                                setErrorMsg("Authentication Failed: " + authErr.message);
                                setConfigError(true);
                                setLoading(false);
                            }
                        }
                    });

                    const params = new URLSearchParams(window.location.search);
                    const mode = params.get('mode');
                    if (mode === 'kiosk') setViewMode('kiosk');
                    if (mode === 'display') setViewMode('display');

                    return () => unsubAuth();
                } catch (err) {
                    console.error("Init Error:", err);
                    setErrorMsg("Init Failed: " + err.message);
                    setConfigError(true);
                    setLoading(false);
                }
            }, []);

            // Data Sync Effect
            useEffect(() => {
                if (!services?.db || !user) return; 
                
                let collectionRef;
                if (typeof __app_id !== 'undefined') {
                     collectionRef = services.db.collection('artifacts').doc(appId)
                            .collection('public').doc('data')
                            .collection('queues');
                } else {
                     collectionRef = services.db.collection('queues');
                }

                const unsub = collectionRef.onSnapshot(snapshot => {
                    const loaded = [];
                    snapshot.forEach(doc => loaded.push({ id: doc.id, ...doc.data() }));
                    loaded.sort((a, b) => a.createdAt - b.createdAt);
                    setQueues(loaded);
                    setLoading(false);
                }, err => {
                    if (err.code !== 'permission-denied') console.error("Sync error:", err);
                    if (err.code === 'permission-denied') {
                        setErrorMsg("Permission Denied: ตรวจสอบ Rules");
                        setConfigError(true);
                    }
                    setLoading(false);
                });

                return () => unsub();
            }, [services, user]); 

            // Notification & Sound Effect (Kiosk/Client Mode)
            useEffect(() => {
                if (!myQueueId || queues.length === 0) return;
                const myQ = queues.find(q => q.id === myQueueId);
                
                if (myQ && myQ.status === 'serving' && lastAnnouncedMyQueueRef.current !== myQ.id) {
                    // 1. ส่ง Notification
                    try {
                        if ('Notification' in window && Notification.permission === 'granted') {
                             new Notification("ถึงคิวของคุณแล้ว!", {
                                 body: `คิวที่ ${myQ.number} เชิญที่ช่องบริการ`,
                                 icon: 'https://cdn-icons-png.flaticon.com/512/3119/3119338.png'
                             });
                        }
                    } catch (e) { console.log("Notification failed", e); }

                    // 2. พูดเสียงเรียก (เฉพาะถ้าอยู่หน้า Kiosk)
                    if (viewMode === 'kiosk') {
                        announceQueue(myQ.number, myQ.name);
                    }

                    lastAnnouncedMyQueueRef.current = myQ.id;
                }
            }, [queues, myQueueId, viewMode]);

            // Sound Effect (Display Mode - Public Announcement)
            useEffect(() => {
                if (viewMode !== 'display' || queues.length === 0) return;
                
                const currentServing = queues.find(q => q.status === 'serving');
                
                if (currentServing && lastAnnouncedDisplayRef.current !== currentServing.id) {
                    setTimeout(() => {
                        announceQueue(currentServing.number, currentServing.name);
                    }, 500);
                    
                    lastAnnouncedDisplayRef.current = currentServing.id;
                }
            }, [queues, viewMode]);

            // --- Enable Audio Helper ---
            const enableAudio = () => {
                // Play silent sound to unlock audio context on iOS/Chrome
                const audio = new Audio('');
                audio.play().then(() => {
                    setAudioEnabled(true);
                    announceQueue("ทดสอบ", "ระบบเสียง");
                }).catch(() => setAudioEnabled(true));
            };

            // --- Actions ---

            const handleBookQueue = async (e) => {
                e.preventDefault();
                if (!customerName.trim()) { alert("กรุณากรอกชื่อ"); return; }
                if (!services || !user) { alert("ระบบไม่พร้อมใช้งาน"); return; }

                setIsSubmitting(true);

                try {
                    if ('Notification' in window && Notification.permission !== 'granted') {
                        Notification.requestPermission();
                    }
                } catch (e) {}

                const maxNum = queues.reduce((max, q) => {
                    const n = parseInt(q.number.split('-')[1]);
                    return n > max ? n : max;
                }, 0);
                const nextNum = String(maxNum + 1).padStart(3, '0');
                const queueNumber = `A-${nextNum}`;

                try {
                    let collectionRef;
                    if (typeof __app_id !== 'undefined') {
                         collectionRef = services.db.collection('artifacts').doc(appId)
                                .collection('public').doc('data')
                                .collection('queues');
                    } else {
                         collectionRef = services.db.collection('queues');
                    }

                    const ref = await collectionRef.add({
                        number: queueNumber,
                        name: customerName,
                        status: 'waiting',
                        createdAt: Date.now(),
                        timestamp: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})
                    });
                    
                    localStorage.setItem('my_queue_id', ref.id);
                    setMyQueueId(ref.id);
                    setCustomerName('');
                } catch (err) {
                    alert("Error: " + err.message);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const updateStatus = async (id, status) => {
                if (!user) return;
                try {
                    let docRef;
                    if (typeof __app_id !== 'undefined') {
                         docRef = services.db.collection('artifacts').doc(appId)
                            .collection('public').doc('data')
                            .collection('queues').doc(id);
                    } else {
                         docRef = services.db.collection('queues').doc(id);
                    }
                    await docRef.update({ status });
                } catch (err) { console.error(err); }
            };

            const handleCancelMyQueue = () => {
                localStorage.removeItem('my_queue_id');
                setMyQueueId(null);
            };

            const openKioskLink = () => {
                const url = new URL(window.location.href);
                url.searchParams.set('mode', 'kiosk');
                window.open(url.toString(), '_blank');
            };

            // --- Helpers ---
            const waitingQueues = queues.filter(q => q.status === 'waiting');
            const currentServing = queues.find(q => q.status === 'serving');
            const myQueue = queues.find(q => q.id === myQueueId);

            if (configError) return <SetupError errorMsg={errorMsg} />;
            if (loading) return <div className="h-screen flex items-center justify-center text-slate-400">กำลังเชื่อมต่อระบบ...</div>;

            // --- KIOSK MODE ---
            if (viewMode === 'kiosk') {
                return (
                    <div className="min-h-screen bg-slate-100 flex flex-col items-center justify-center p-4">
                        <div className="absolute top-4 text-slate-400 text-sm font-bold tracking-widest uppercase">Q-Master Kiosk</div>
                        
                        {(!myQueue || myQueue.status === 'completed' || myQueue.status === 'cancelled') ? (
                            <div className="bg-white w-full max-w-md rounded-3xl shadow-xl overflow-hidden animate-fade-in">
                                <div className="bg-indigo-600 p-8 text-white text-center">
                                    <h1 className="text-3xl font-bold mb-2">กดรับบัตรคิว</h1>
                                    <p className="text-indigo-100">กรอกชื่อเพื่อเข้าสู่ระบบรอเรียก</p>
                                </div>
                                <div className="p-8">
                                    <form onSubmit={handleBookQueue} className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">ชื่อผู้จอง</label>
                                            <input 
                                                autoFocus
                                                type="text" 
                                                value={customerName}
                                                onChange={e => setCustomerName(e.target.value)}
                                                className="w-full px-4 py-4 text-lg border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                                placeholder="เช่น คุณสมชาย"
                                                disabled={isSubmitting}
                                            />
                                        </div>
                                        <button 
                                            type="submit" 
                                            disabled={isSubmitting}
                                            className={`w-full text-white font-bold py-4 rounded-xl text-lg shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2
                                                ${isSubmitting ? 'bg-indigo-400 cursor-wait' : 'bg-indigo-600 hover:bg-indigo-700 active:scale-95'}`}
                                        >
                                            {isSubmitting ? <><Icons.Loader size={24}/> กำลังบันทึก...</> : 'ยืนยันการจอง'}
                                        </button>
                                        <div className="text-center text-slate-400 text-sm">
                                            ขณะนี้มีคิวรออยู่ <span className="text-indigo-600 font-bold">{waitingQueues.length}</span> คิว
                                        </div>
                                    </form>
                                </div>
                            </div>
                        ) : (
                            <div className="bg-white w-full max-w-md rounded-3xl shadow-xl overflow-hidden animate-fade-in relative">
                                <div className="h-2 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                                <div className="p-8 text-center space-y-8">
                                    <div>
                                        <span className="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-xs font-bold tracking-wide">YOUR QUEUE</span>
                                        <h1 className="text-7xl font-black text-slate-800 mt-4 tracking-tighter">{myQueue.number}</h1>
                                    </div>
                                    <div className={`inline-flex items-center gap-2 px-6 py-3 rounded-full font-bold shadow-sm
                                        ${myQueue.status === 'waiting' ? 'bg-amber-50 text-amber-600 border border-amber-100' : ''}
                                        ${myQueue.status === 'serving' ? 'bg-green-50 text-green-600 border border-green-100 animate-pulse' : ''}
                                    `}>
                                        {myQueue.status === 'waiting' ? <><Icons.Clock size={20}/> กำลังรอเรียก...</> : <><Icons.Volume size={20}/> ถึงคิวคุณแล้ว!</>}
                                    </div>
                                    <div className="bg-slate-50 rounded-2xl p-6 border border-slate-100">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-slate-400 text-sm">ชื่อผู้จอง</span>
                                            <span className="font-bold text-slate-700">{myQueue.name}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-400 text-sm">คิวที่ต้องรอ</span>
                                            <span className="font-bold text-indigo-600">
                                                {queues.filter(q => q.status === 'waiting' && q.createdAt < myQueue.createdAt).length} คิว
                                            </span>
                                        </div>
                                    </div>
                                    {myQueue.status === 'serving' && (
                                        <div className="text-green-600 font-bold animate-bounce-slow">
                                            กรุณาติดต่อที่ช่องบริการ 1 ครับ
                                        </div>
                                    )}
                                    <button onClick={handleCancelMyQueue} className="text-slate-400 text-sm hover:text-slate-600 underline">
                                        จองคิวใหม่ / ออกจากหน้านี้
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // --- ADMIN & DISPLAY MODE ---
            return (
                <div className="min-h-screen bg-slate-50">
                    {/* Navbar (Only in Admin) */}
                    {viewMode === 'admin' && (
                        <div className="bg-white border-b border-slate-200 sticky top-0 z-50 px-4 py-3 shadow-sm">
                            <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-2 font-bold text-xl text-indigo-900">
                                    <div className="bg-indigo-600 text-white w-8 h-8 rounded flex items-center justify-center">Q</div>
                                    Q-Master Admin
                                </div>
                                <div className="flex gap-2 bg-slate-100 p-1 rounded-lg">
                                    <button onClick={() => setViewMode('admin')} className={`px-4 py-1.5 rounded-md text-sm font-bold transition-all ${viewMode==='admin' ? 'bg-white shadow text-indigo-600':'text-slate-500'}`}>Admin</button>
                                    <button onClick={() => setViewMode('display')} className={`px-4 py-1.5 rounded-md text-sm font-bold transition-all ${viewMode==='display' ? 'bg-white shadow text-indigo-600':'text-slate-500'}`}>Display</button>
                                </div>
                                <button onClick={openKioskLink} className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition-all shadow-md">
                                    <Icons.Link size={16}/> เปิดหน้าลูกค้า (Kiosk Link)
                                </button>
                            </div>
                        </div>
                    )}

                    {viewMode === 'display' ? (
                        <div className="min-h-screen flex items-center justify-center p-8 bg-slate-100">
                            {/* Display Mode - Centered & Wider Layout */}
                            <div className="flex flex-col lg:flex-row gap-8 w-full max-w-[90vw] h-[85vh]">
                                {/* Left: Current Queue */}
                                <div className="flex-1 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-white relative overflow-hidden p-8">
                                    {!audioEnabled && (
                                        <button onClick={enableAudio} className="absolute top-4 right-4 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full text-sm backdrop-blur-md flex items-center gap-2 transition-all z-50">
                                            <Icons.Volume size={16}/> เปิดเสียงเรียก
                                        </button>
                                    )}
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2"></div>
                                    <h2 className="text-2xl font-medium opacity-80 mb-8 uppercase tracking-widest">Calling Queue</h2>
                                    {currentServing ? (
                                        <div className="text-center animate-bounce-slow">
                                            <div className="text-[10rem] md:text-[14rem] font-black leading-none tracking-tighter drop-shadow-lg">
                                                {currentServing.number}
                                            </div>
                                            <div className="mt-8 bg-white/20 backdrop-blur-md px-10 py-4 rounded-full inline-block">
                                                <span className="text-3xl md:text-4xl font-bold">คุณ {currentServing.name}</span>
                                            </div>
                                            <div className="mt-10 text-2xl text-indigo-200 font-bold animate-pulse">
                                                เชิญที่ช่องบริการ 1
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center opacity-40">
                                            <div className="text-9xl font-black">---</div>
                                            <div className="text-2xl mt-4">Waiting for queue...</div>
                                        </div>
                                    )}
                                </div>
                                {/* Right: Waiting List (Wider) */}
                                <div className="w-full lg:w-[30rem] bg-white rounded-3xl shadow-xl border border-slate-100 flex flex-col overflow-hidden">
                                    <div className="p-6 bg-slate-50 border-b border-slate-100 font-bold text-slate-600 flex items-center gap-2">
                                        <Icons.Clock size={20} className="text-indigo-500"/> Next Queue
                                    </div>
                                    <div className="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar">
                                        {waitingQueues.slice(0, 8).map((q) => (
                                            <div key={q.id} className="flex items-center justify-between p-4 bg-white border border-slate-100 rounded-xl shadow-sm">
                                                <div className="flex items-center gap-4 w-full">
                                                    <div className="w-14 h-14 bg-slate-100 rounded-lg flex-shrink-0 flex items-center justify-center font-bold text-xl text-slate-600">
                                                        {q.number}
                                                    </div>
                                                    <div className="min-w-0 flex-1">
                                                        <div className="font-bold text-slate-800 text-lg whitespace-nowrap overflow-hidden text-ellipsis">
                                                            คุณ {q.name}
                                                        </div>
                                                        <div className="text-xs text-slate-400">Waiting</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        {waitingQueues.length === 0 && (
                                            <div className="text-center py-10 text-slate-300">No waiting queues</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        // Admin Mode Layout
                        <main className="max-w-7xl mx-auto p-4 md:p-6">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2 space-y-6">
                                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                        <h2 className="font-bold text-slate-800 mb-6 flex items-center gap-2"><Icons.Monitor className="text-indigo-600"/> จุดบริการ 1 (Service Point)</h2>
                                        
                                        {currentServing ? (
                                            <div className="flex flex-col md:flex-row items-center justify-between gap-6 bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                                                <div className="text-center md:text-left">
                                                    <div className="text-xs font-bold text-indigo-400 uppercase tracking-wide">Serving Now</div>
                                                    <div className="text-5xl font-black text-slate-800 mt-1 mb-2">{currentServing.number}</div>
                                                    <div className="text-xl font-medium text-slate-600">คุณ {currentServing.name}</div>
                                                </div>
                                                <div className="flex gap-3 w-full md:w-auto">
                                                    <button onClick={() => updateStatus(currentServing.id, 'completed')} className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl font-bold shadow-lg shadow-green-200 transition-all active:scale-95">
                                                        <Icons.Check/> เสร็จสิ้น
                                                    </button>
                                                    <button onClick={() => updateStatus(currentServing.id, 'cancelled')} className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-white border border-red-200 text-red-500 hover:bg-red-50 px-6 py-4 rounded-xl font-bold transition-all active:scale-95">
                                                        <Icons.Cross/> ยกเลิก
                                                    </button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="border-2 border-dashed border-slate-200 rounded-xl p-10 text-center text-slate-400">
                                                ยังไม่มีการเรียกคิว กด "เรียกคิว" จากรายการด้านล่าง
                                            </div>
                                        )}
                                    </div>

                                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                        <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                            <h2 className="font-bold text-slate-800 flex items-center gap-2"><Icons.Users className="text-indigo-600"/> รายการรอเรียก ({waitingQueues.length})</h2>
                                        </div>
                                        <div className="divide-y divide-slate-50">
                                            {waitingQueues.length > 0 ? waitingQueues.map((q) => (
                                                <div key={q.id} className="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-14 h-14 bg-slate-100 rounded-lg flex items-center justify-center font-bold text-xl text-slate-600">
                                                            {q.number}
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-slate-800 text-lg">{q.name}</div>
                                                            <div className="text-xs text-slate-400">{q.timestamp}</div>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={() => updateStatus(q.id, 'serving')}
                                                        disabled={!!currentServing}
                                                        className={`flex items-center gap-2 px-6 py-2 rounded-lg font-bold text-sm transition-all shadow-sm
                                                            ${currentServing 
                                                                ? 'bg-slate-100 text-slate-400 cursor-not-allowed' 
                                                                : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200 active:scale-95'}`}
                                                    >
                                                        <Icons.Bell size={18}/> เรียกคิว
                                                    </button>
                                                </div>
                                            )) : (
                                                <div className="p-10 text-center text-slate-400">ไม่มีคิวรอเรียก</div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 sticky top-24">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wide mb-4">ภาพรวมวันนี้</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center p-4 bg-slate-50 rounded-xl">
                                                <span className="text-slate-600 font-medium">คิวทั้งหมด</span>
                                                <span className="text-2xl font-black text-slate-800">{queues.length}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-4 bg-green-50 rounded-xl">
                                                <span className="text-green-700 font-medium">เสร็จสิ้น</span>
                                                <span className="text-2xl font-black text-green-700">{queues.filter(q => q.status==='completed').length}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-4 bg-red-50 rounded-xl">
                                                <span className="text-red-700 font-medium">ยกเลิก</span>
                                                <span className="text-2xl font-black text-red-700">{queues.filter(q => q.status==='cancelled').length}</span>
                                            </div>
                                        </div>
                                        <div className="mt-6 pt-6 border-t border-slate-100 text-sm text-slate-400">
                                            <p className="font-bold mb-2">วิธีใช้งาน:</p>
                                            <ul className="list-disc pl-4 space-y-1">
                                                <li>กดปุ่ม "เปิดหน้าลูกค้า" เพื่อส่งลิงก์ให้ลูกค้ากดจอง</li>
                                                <li>กดปุ่ม "เรียกคิว" เมื่อช่องบริการว่าง</li>
                                                <li>กด "เสร็จสิ้น" เมื่อให้บริการเสร็จ</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </main>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
